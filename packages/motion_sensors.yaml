homeassistant:
  customize:
    sensor.passage_movement:
      homebridge_visible: true
      device_type: opening
    sensor.upstairs_hallway_movement:
      homebridge_visible: true
      device_type: opening
sensor:
  - platform: template
    sensors:
      passage_movement:
        friendly_name: 'Passage Movement'
        value_template: '{% if is_state("binary_sensor.passage_pir_sensor", "on") %}Movement detected{% else %}No movement{% endif %}'
        icon_template: '{% if is_state("binary_sensor.passage_pir_sensor", "on") %}mdi:run-fast{% else %}mdi:sleep{% endif %}'

      upstairs_hallway_movement:
        friendly_name: 'Upstairs Hallway Movement'
        value_template: '{% if is_state("binary_sensor.upstairs_hallway_pir_sensor", "on") %}Movement detected{% else %}No movement{% endif %}'
        icon_template: '{% if is_state("binary_sensor.upstairs_hallway_pir_sensor", "on") %}mdi:run-fast{% else %}mdi:sleep{% endif %}'

  - platform: template
    sensors:
      last_seen_motion:
        friendly_name: 'Last Seen Motion'
        value_template: >
                    {%- set pirs = [states.sensor.passage_movement, states.sensor.upstairs_hallway_movement, states.binary_sensor.motion_sensor_158d000165ff1f, states.binary_sensor.motion_sensor_158d0001a66256] %}
                    {% for pir in pirs %}
                      {% if as_timestamp(pir.last_changed) == as_timestamp(pirs | map(attribute='last_changed') | max) %}
                        {{ pir.name }}
                      {% endif %}
                    {% endfor %}